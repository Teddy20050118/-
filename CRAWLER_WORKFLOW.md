# é¤å»³èœå–®çˆ¬èŸ²åŠŸèƒ½èªªæ˜

## ğŸ¯ å®Œæ•´æµç¨‹

### æ–¹æ¡ˆï¼šGoogle Maps æœå°‹ + Foodpanda çˆ¬å–èœå–®

é€™æ˜¯ç›®å‰æœ€å¯¦ç”¨çš„æ··åˆå¼æ–¹æ¡ˆï¼š

```
ä½¿ç”¨è€…é»æ“Šã€ŒğŸ•·ï¸ çˆ¬èœå–®ã€
    â†“
è¼¸å…¥é—œéµå­—ï¼ˆä¾‹å¦‚ï¼šã€Œå°ä¸­ ç«é‹ã€ï¼‰
    â†“
ã€å¾Œç«¯ã€‘å¾ Google Maps çˆ¬å–é¤å»³æ¸…å–®
    â†“
ã€å‰ç«¯ã€‘é¡¯ç¤º 5 é–“é¤å»³ä¾›é¸æ“‡
    1. å²å ¤å…‹ç‰›æ’å¤§ç”²åº— â­4.7
    2. æ„›å°‡å¹³åƒ¹ç‰›æ’ï¼å¤§ç”²åº— â­3.9
    ...
    â†“
ä½¿ç”¨è€…è¼¸å…¥æ•¸å­—ï¼ˆä¾‹å¦‚ï¼š1ï¼‰
    â†“
ã€å¾Œç«¯ã€‘å¾ Foodpanda çˆ¬å–è©²é¤å»³çš„å®Œæ•´èœå–®
    â†“
ã€å‰ç«¯ã€‘é¡¯ç¤ºå®Œæ•´èœå–®ï¼ˆå¯èƒ½æœ‰æ•¸åé“èœï¼‰
    â†“
ä½¿ç”¨è€…å¯ä»¥é–‹å§‹é»é¤å°è©±
```

## ğŸ“ æª”æ¡ˆçµæ§‹

### çˆ¬èŸ²æ¨¡çµ„

1. **`crawler.py`** - Google Maps çˆ¬èŸ²
   - åŠŸèƒ½ï¼šæœå°‹é¤å»³ã€ç²å–åŸºæœ¬è³‡è¨Šï¼ˆåç¨±ã€è©•åˆ†ã€åœ°å€ï¼‰
   - é™åˆ¶ï¼šå¾ˆå°‘é¤å»³æœ‰çµæ§‹åŒ–çš„èœå–®è³‡æ–™
   - ç”¨é€”ï¼šç¬¬ä¸€éšæ®µ - ç²å–é¤å»³æ¸…å–®

2. **`foodpanda_crawler.py`** - Foodpanda çˆ¬èŸ² â­ NEW
   - åŠŸèƒ½ï¼šæœå°‹ä¸¦çˆ¬å–é¤å»³çš„å®Œæ•´èœå–®
   - å„ªå‹¢ï¼šFoodpanda æœ‰çµæ§‹åŒ–çš„èœå–®è³‡æ–™
   - ç”¨é€”ï¼šç¬¬äºŒéšæ®µ - çˆ¬å–å®Œæ•´èœå–®

### API ç«¯é»

1. **`POST /api/crawl`** - Google Maps æœå°‹
   ```json
   // è«‹æ±‚
   {
     "query": "å°ä¸­ ç«é‹",
     "maxShops": 5
   }
   
   // å›æ‡‰
   {
     "success": true,
     "restaurants": [
       {
         "name": "é¼ç‹éº»è¾£é‹",
         "rating": 4.3,
         "address": "å°ä¸­å¸‚...",
         "menuItemCount": 0
       }
     ]
   }
   ```

2. **`POST /api/crawl-foodpanda`** - Foodpanda èœå–®çˆ¬å– â­ NEW
   ```json
   // è«‹æ±‚
   {
     "restaurantName": "é¼ç‹éº»è¾£é‹",
     "city": "taichung"
   }
   
   // å›æ‡‰
   {
     "success": true,
     "message": "æˆåŠŸçˆ¬å– é¼ç‹éº»è¾£é‹ çš„èœå–®ï¼Œå…± 45 é“èœ",
     "restaurant": {
       "name": "é¼ç‹éº»è¾£é‹",
       "rating": 4.3,
       "deliveryTime": "30-40 åˆ†é˜"
     },
     "menuItems": [
       {
         "dish": "éº»è¾£é‹",
         "price": "NT$400",
         "description": "ç¶“å…¸éº»è¾£æ¹¯åº•",
         "restaurant": "é¼ç‹éº»è¾£é‹"
       }
     ]
   }
   ```

## ğŸ¨ å‰ç«¯äº’å‹•æµç¨‹

### ä½¿ç”¨è€…è¦–è§’

1. **é»æ“Šçˆ¬èŸ²æŒ‰éˆ•**
   ```
   [ğŸ•·ï¸ çˆ¬èœå–®] æŒ‰éˆ•ï¼ˆåœ¨é ‚éƒ¨å³å´ï¼‰
   ```

2. **è¼¸å…¥æœå°‹é—œéµå­—**
   ```
   è«‹è¼¸å…¥è¦æœå°‹çš„é¤å»³é—œéµå­—
   ä¾‹å¦‚ï¼šã€Œå°ä¸­ ç«é‹ã€ã€ã€Œæ²™é¹¿ é¤å»³ã€
   ```

3. **æŸ¥çœ‹é¤å»³æ¸…å–®**
   ```
   âœ… æˆåŠŸçˆ¬å– 5 é–“é¤å»³

   æ‰¾åˆ°çš„é¤å»³ï¼š
   1. å²å ¤å…‹ç‰›æ’å¤§ç”²åº— â­4.7
   2. æ„›å°‡å¹³åƒ¹ç‰›æ’ï¼å¤§ç”²åº— â­3.9
   3. å¤§ç”²ä¾†å®¢ç‰›æ’ â­4.2
   4. æ¿ƒæ¿ƒè¥¿é¤ â­3.8
   5. ä¾†æ€¡å®¢ç‰›æ’ â­3.8

   ğŸ’¡ æƒ³æŸ¥çœ‹æŸé–“é¤å»³çš„å®Œæ•´èœå–®ï¼Ÿ
   è«‹è¼¸å…¥é¤å»³ç·¨è™Ÿï¼ˆ1-5ï¼‰ï¼Œæˆ‘æœƒå¾ Foodpanda çˆ¬å–å®Œæ•´èœå–®ï¼
   ```

4. **é¸æ“‡é¤å»³**
   ```
   ä½¿ç”¨è€…è¼¸å…¥ï¼š1
   ```

5. **æŸ¥çœ‹å®Œæ•´èœå–®**
   ```
   âœ… æˆåŠŸçˆ¬å– å²å ¤å…‹ç‰›æ’å¤§ç”²åº— çš„èœå–®ï¼Œå…± 32 é“èœ

   é¤å»³ï¼šå²å ¤å…‹ç‰›æ’å¤§ç”²åº—
   è©•åˆ†ï¼šâ­4.7
   å¤–é€æ™‚é–“ï¼š25-35 åˆ†é˜

   èœå–®ï¼ˆå‰ 20 é“ï¼‰ï¼š
   1. ç¶“å…¸ç‰›æ’ - NT$280
   2. é›è…¿æ’ - NT$200
   3. è±¬æ’ - NT$180
   ...

   ğŸ’¡ é€™äº›èœå–®è³‡æ–™å·²æš«å­˜ï¼Œä½ å¯ä»¥é–‹å§‹é»é¤äº†ï¼
   ```

6. **é–‹å§‹é»é¤**
   ```
   ä½¿ç”¨è€…ï¼šæˆ‘è¦ç¶“å…¸ç‰›æ’ 1 ä»½å’Œç´…èŒ¶
   ```

## ğŸ”§ æŠ€è¡“å¯¦ä½œ

### å‰ç«¯é‚è¼¯ (web/web.html)

```javascript
// 1. å„²å­˜é¤å»³æ¸…å–®
window.lastCrawledRestaurants = [/* å¾ Google Maps çˆ¬å–çš„é¤å»³ */];

// 2. æª¢æ¸¬ä½¿ç”¨è€…è¼¸å…¥æ•¸å­—
if (window.lastCrawledRestaurants && /^[1-5]$/.test(text)) {
  const restaurant = window.lastCrawledRestaurants[idx];
  await crawlFoodpandaMenu(restaurant.name);
}

// 3. å‘¼å« Foodpanda API
const crawlFoodpandaMenu = async (restaurantName) => {
  const res = await fetch('/api/crawl-foodpanda', {
    method: 'POST',
    body: JSON.stringify({ restaurantName, city: 'taichung' })
  });
  // é¡¯ç¤ºèœå–®...
};
```

### å¾Œç«¯é‚è¼¯ (src/back.py)

```python
@app.post("/api/crawl-foodpanda")
async def api_crawl_foodpanda(req: FoodpandaReq):
    from foodpanda_crawler import crawl_foodpanda, to_menu_json
    
    # 1. å¾ Foodpanda æœå°‹ä¸¦çˆ¬å–èœå–®
    restaurant = await crawl_foodpanda(req.restaurantName, req.city)
    
    # 2. è½‰æ›ç‚ºæ¨™æº–æ ¼å¼
    menu_data = to_menu_json(restaurant)
    
    # 3. å›å‚³çµ¦å‰ç«¯
    return FoodpandaResp(
        success=True,
        menuItems=menu_data,
        restaurant={...}
    )
```

### Foodpanda çˆ¬èŸ²é‚è¼¯ (foodpanda_crawler.py)

```python
async def crawl_foodpanda(restaurant_name: str, city: str):
    # 1. å‰å¾€ Foodpanda æœå°‹é 
    await page.goto(f"https://www.foodpanda.com.tw/city/{city}")
    
    # 2. è¼¸å…¥æœå°‹é—œéµå­—
    await search_input.fill(restaurant_name)
    await search_input.press('Enter')
    
    # 3. æå–æœå°‹çµæœï¼ˆé¤å»³æ¸…å–®ï¼‰
    restaurants = await search_foodpanda(page, restaurant_name)
    
    # 4. å‰å¾€ç¬¬ä¸€é–“é¤å»³çš„é é¢
    target_restaurant = restaurants[0]
    await page.goto(target_restaurant.url)
    
    # 5. çˆ¬å–èœå–®é …ç›®
    menu_items = await page.query_selector_all('[data-testid^="menu-product-"]')
    
    # 6. æå–æ¯é“èœçš„åç¨±ã€åƒ¹æ ¼ã€æè¿°
    for item in menu_items:
        name = await item.query_selector('.dish-name')
        price = await item.query_selector('.price')
        # ...
```

## âš™ï¸ åŸå¸‚ä»£ç¢¼å°ç…§

```python
CITY_CODES = {
    "taipei": "å°åŒ—",
    "taichung": "å°ä¸­",
    "kaohsiung": "é«˜é›„",
    "taoyuan": "æ¡ƒåœ’",
    "tainan": "å°å—",
    "hsinchu": "æ–°ç«¹",
}
```

ç›®å‰é è¨­ç‚º `taichung`ï¼Œå¯åœ¨å‰ç«¯æˆ–å¾Œç«¯ä¿®æ”¹ã€‚

## ğŸš€ éƒ¨ç½²æ³¨æ„äº‹é …

### Render éƒ¨ç½²

1. **å®‰è£ Playwright**
   ```bash
   pip install playwright
   playwright install chromium
   ```

2. **render.yaml è¨­å®š**
   ```yaml
   services:
     - type: web
       buildCommand: |
         pip install -r requirements.txt
         playwright install chromium --with-deps
   ```

3. **è¨˜æ†¶é«”éœ€æ±‚**
   - Playwright + Chromium éœ€è¦è¼ƒå¤šè¨˜æ†¶é«”
   - å…è²»ç‰ˆå¯èƒ½ä¸ç©©å®šï¼Œå»ºè­°å‡ç´šåˆ°ä»˜è²»æ–¹æ¡ˆ

### æ•ˆèƒ½è€ƒé‡

- Google Maps çˆ¬å–ï¼šç´„ 5-10 ç§’
- Foodpanda çˆ¬å–ï¼šç´„ 10-30 ç§’ï¼ˆå–æ±ºæ–¼èœå–®æ•¸é‡ï¼‰
- å»ºè­°å‰ç«¯é¡¯ç¤º loading å‹•ç•«

## ğŸ“Š è³‡æ–™æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä½¿ç”¨è€…è¼¸å…¥  â”‚ "å°ä¸­ ç«é‹"
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google Maps çˆ¬èŸ²       â”‚
â”‚ crawler.py             â”‚
â”‚ - æœå°‹é¤å»³             â”‚
â”‚ - ç²å–åŸºæœ¬è³‡è¨Š         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¤å»³æ¸…å–®               â”‚
â”‚ 1. é¼ç‹ â­4.3         â”‚
â”‚ 2. å°è‚¥ç¾Š â­4.5       â”‚
â”‚ ...                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä½¿ç”¨è€…é¸æ“‡  â”‚ "1"
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Foodpanda çˆ¬èŸ²         â”‚
â”‚ foodpanda_crawler.py   â”‚
â”‚ - æœå°‹ã€Œé¼ç‹ã€         â”‚
â”‚ - é€²å…¥é¤å»³é é¢         â”‚
â”‚ - çˆ¬å–å®Œæ•´èœå–®         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®Œæ•´èœå–®ï¼ˆ32 é“èœï¼‰    â”‚
â”‚ - éº»è¾£é‹ NT$400        â”‚
â”‚ - é…¸èœç™½è‚‰é‹ NT$380    â”‚
â”‚ - è±¬è¡€ç³• NT$30         â”‚
â”‚ ...                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… å„ªå‹¢

1. **é«˜æˆåŠŸç‡**ï¼šFoodpanda æœ‰çµæ§‹åŒ–çš„èœå–®è³‡æ–™
2. **å®Œæ•´è³‡è¨Š**ï¼šåŒ…å«èœåã€åƒ¹æ ¼ã€æè¿°ã€åœ–ç‰‡
3. **ä½¿ç”¨è€…å‹å–„**ï¼šå…©æ­¥é©Ÿé¸æ“‡ï¼Œé¿å…ç›´æ¥æœå°‹ä¸åˆ°
4. **éˆæ´»æ€§**ï¼šå¯ä»¥æ›å…¶ä»–å¤–é€å¹³å°ï¼ˆUber Eats ç­‰ï¼‰

## âš ï¸ é™åˆ¶

1. **é¤å»³å¿…é ˆåœ¨ Foodpanda ä¸Š**ï¼šä¸æ˜¯æ‰€æœ‰ Google Maps ä¸Šçš„é¤å»³éƒ½æœ‰
2. **åç¨±åŒ¹é…**ï¼šé¤å»³åç¨±éœ€è¦ç›¸è¿‘æ‰èƒ½æœå°‹åˆ°
3. **åçˆ¬èŸ²**ï¼šFoodpanda å¯èƒ½åµæ¸¬ä¸¦å°é–é »ç¹çˆ¬å–
4. **ç¶­è­·æˆæœ¬**ï¼šCSS é¸æ“‡å™¨å¯èƒ½éš¨å¹³å°æ›´æ–°è€Œå¤±æ•ˆ

## ğŸ”® æœªä¾†æ”¹é€²

1. **æ¨¡ç³Šæœå°‹**ï¼šä½¿ç”¨ç›¸ä¼¼åº¦æ¼”ç®—æ³•åŒ¹é…é¤å»³åç¨±
2. **å¤šå¹³å°æ”¯æ´**ï¼šæ•´åˆ Uber Eatsã€Foodomo ç­‰
3. **å¿«å–æ©Ÿåˆ¶**ï¼šå„²å­˜å·²çˆ¬å–çš„èœå–®ï¼Œæ¸›å°‘é‡è¤‡çˆ¬å–
4. **OCR æ•´åˆ**ï¼šå¾èœå–®ç…§ç‰‡æå–è³‡è¨Šä½œç‚ºå‚™æ¡ˆ
5. **çœ¾åŒ…è³‡æ–™**ï¼šè®“ä½¿ç”¨è€…è²¢ç»å’Œç·¨è¼¯èœå–®

## ğŸ“ ä½¿ç”¨ç¯„ä¾‹

### å‘½ä»¤åˆ—æ¸¬è©¦

```bash
# æ¸¬è©¦ Google Maps çˆ¬èŸ²
python crawler.py "å°ä¸­ ç«é‹" --max-shops 5

# æ¸¬è©¦ Foodpanda çˆ¬èŸ²
python foodpanda_crawler.py "é¼ç‹éº»è¾£é‹" taichung
```

### API æ¸¬è©¦

```bash
# æœå°‹é¤å»³
curl -X POST http://localhost:8000/api/crawl \
  -H "Content-Type: application/json" \
  -d '{"query": "å°ä¸­ ç«é‹", "maxShops": 5}'

# çˆ¬å–èœå–®
curl -X POST http://localhost:8000/api/crawl-foodpanda \
  -H "Content-Type: application/json" \
  -d '{"restaurantName": "é¼ç‹éº»è¾£é‹", "city": "taichung"}'
```

## ğŸ‰ ç¸½çµ

é€™å€‹æ··åˆå¼æ–¹æ¡ˆçµåˆäº†ï¼š
- âœ… Google Maps çš„å»£æ³›é¤å»³è³‡è¨Š
- âœ… Foodpanda çš„çµæ§‹åŒ–èœå–®è³‡æ–™
- âœ… ä½¿ç”¨è€…å‹å–„çš„å…©æ­¥é©Ÿé¸æ“‡æµç¨‹

æ˜¯ç›®å‰æœ€å¯¦ç”¨ä¸”æˆåŠŸç‡æœ€é«˜çš„èœå–®çˆ¬èŸ²è§£æ±ºæ–¹æ¡ˆï¼
